## 목차
- [쿠키](#쿠키)
- [세션과 토큰](#세션과-토큰)
- [세션과 JWT 방식 정리](#세션과-jwt-방식-정리)
- [JWT를 사용할 때 주의해야할 점](#jwt를-사용할-때-주의해야할-점)

### 쿠키
쿠키는 **브라우저에서만 사용할 수 있는 것으로 서버와 클라이언트가 인증을 위해 필요한 정보를
주고 받는 매개체이다.** 서버는 클라이언트의 요청으로부터 응답을 보낼 때, 쿠키를 함께 보낸다.
그러면 클라이언트는 첫 요청 이후에 받은 **쿠키를 활용하여 이후 서버에 요청을 보낼 때 함께 보낸다.**
#### 쿠키의 특징
- 쿠키는 정해진 도메인에서만 사용가능하다. (ex. 유튜브 쿠키는 유튜브 서버에서만 사용)
- 쿠키는 유효기간(서버에서 설정한 시간)이 정해져있다.
- 쿠키를 사용하면 사용자가 원하는 언어 설정 정보를 저장할 수 있다. (ex. 쿠키에 언어 설정 정보를 담을 수 있음)

### 세션과 토큰
세션과 토큰의 필요성을 이해하려면 먼저 HTTP 프로토콜의 **Stateless**를 알아야 한다.
https://github.com/whxogus215/Backend-Study-Archive/blob/main/Http/HTTP.md#stateless

**무연결성을 갖기 때문에 각각의 요청이 모두 독립적이다.** 따라서 사용자의 요청 정보를 저장하고,
사용자만의 고유한 ID를 저장할 수 있는데 이것이 바로 세션 방식이다. 세션 DB에 사용자의 정보와, 세션 ID를 저장하고
사용자에게 응답으로 세션 ID를 전달한다. 이를 받은 클라이언트는 이후 요청에 있어서 해당 세션 ID를 **쿠키에 담아 전송한다.**
그러면 서버는 세션 DB를 조회하여 전달받은 세션 ID가 있는지 확인한다. 이것이 바로 세션 인증 방식이다.

**서버에서 클라이언트의 중요한 정보를 다 갖고 있으며, 클라이언트는 그저 세션 ID만을 전달받는다.**

하지만 세션 ID를 전달하기 위한 매개체인 **쿠키는 웹 브라우저에서만 지원한다. 따라서 안드로이드, iOS 같은
모바일에서는 해당 세션 정보를 전달하기 위한 새로운 매개체가 필요한데 그것이 바로 토큰이다.**
토큰은 `이상하게 생긴 String이다.(노마드 코더 왈)` 세션 방식에서 쿠키가 아닌 토큰을 사용할 경우,
서버에서는 해당 문자열을 해독하여 마찬가지로 세션 DB를 조회하게 된다.

#### 세션의 특징
- 세션 방식의 경우, 서버는 사용자에 대한 정보를 세션 DB에 항상 저장하고 요청이 들어올 때마다 DB를 조회해야 한다.
  - 사용자가 점점 많아질 경우, 리소스가 증가한다.

이러한 서버의 과도한 부하를 줄이기 위해 등장한 것이 **JWT(JSON Web Token)**이다.
JWT는 토큰이기에 이 또한 무작위 값을 갖는 문자열이다. 따라서 서버는 사용자의 아이디 등에 대해
인증 알고리즘을 사용하여 토큰 값(String)을 만들어낸다. DB를 조작하지 않고, 정보를 사인하여 전달하는 것이 세션과의 차이점이다.
JWT의 값은 길이가 매우 긴데, 공간 제약을 받는 쿠키에 비해 제약이 없는 토큰 방식에서는 긴 문자열을 사용해도
큰 문제가 되지 않는다.

서버는 전달받은 토큰이 조작되지 않았는지만 검증하고, 사용자를 인증한다. 

### 세션과 JWT 방식 정리
- 세션은 서버에서 세션 ID만을 만들어서 전달하면 된다. 또한 세션 DB를 통해 세션 ID를 관리한다.
- JWT는 유저를 인증하기 위해 필요한 정보를 모두 토큰에 저장한다. 이 토큰을 클라이언트에게 전달하고, 토큰에 대한 유효성 검사만 진행한다.
  - JWT는 암호화되지 않았기 때문에 모두가 읽고 쓸 수 있다. 따라서 비밀번호와 같이 민감한 정보가 담겨있어선 안된다.

- 세션의 장점
  - 세션은 사용자의 세션 ID를 DB에 저장하고 있기 때문에 맘에 들지 않는 사용자를 차단할 수 있다. 세션 DB에서 해당 세션 ID를 지우기만 하면 된다.
  - 인스타그램, 넷플릭스와 같이 연결되어 있는 기기의 접근 권한을 삭제하는 등의 방식을 예로 들 수 있다.
- 세션의 단점
  - 사용자가 늘어날수록 필요한 DB가 늘어난다. 따라서 빠르고 저렴한 `Redis`를 세션 DB로 주로 사용한다.
- JWT의 장점
  - 서버는 토큰(JWT)을 추적하지 않는다. 그저 토큰이 유효한지에 대해서만 검증한다. 따라서 인증을 하기 위한
  별도의 DB가 필요하지 않다.
  - Stateless한 요청들이기 때문에, 동시 접속하는 이용자가 많아질수록 서버의 부담이 세션 방식에 비해 줄어든다.
- JWT의 단점
  - 세션 방식과 다르게 임의로 유저를 삭제할 수 없다. (토큰이 만료되기 전까지 계속 유지할 수 있다.)

### JWT를 사용할 때 주의해야할 점
1. 알고리즘이 `none`으로 되어있으면 안된다. 최신 라이브러리를 사용하여 해당 문제를 해결할 수 있다. (HS256으로 설정되어 있지 않은 토큰에 대해
통과하지 못하도록 하는 기능 등)
2. JWT는 디코딩을 누구나 할 수 있다. 따라서 민감한 정보가 들어가있으면 안된다.
3. JWT에 설정하는 시크릿 키를 단순하게 설정하면 안된다. 브루트 포스 공격으로 인해 뚫릴 수도 있기 때문이다.
    - 시크릿 키를 매우 길게 만들고, 공유를 금지한다.
    - 개인키와 공개키를 활용하여 보안을 강화한다. (라이브러리 사용)
4. JWT를 도난당했을 경우, 세션 방식과 다르게 이를 금지시킬 방법이 없다.
    - HttpOnly Cookie를 사용해서 훔치기 어렵게 만든다.
    - JWT 블랙리스트를 운영한다. (이는 세션방식과 동일해진다는 문제가 있다.)
    - JWT 유효기간을 짧게 지정한다. (ex. 5분) - Refresh 토큰을 함께 사용한다. (ref. Refresh Token Rotation 필요)

출처 1(노마드 코더) : https://www.youtube.com/watch?v=tosLBcAX1vk
출처 2(코딩애플) : https://www.youtube.com/watch?v=XXseiON9CV0
